# Teacher Tools - 功能设计文档

## 📋 文档信息

**文档版本**: 1.0.0
**创建日期**: 2025-12-24
**最后更新**: 2025-12-24
**文档状态**: 初稿

---

## 🎯 产品定位

### 核心价值
为教师提供一款**轻量级、高效率**的移动端学生信息管理工具，支持快速记录、批量导入、多班级管理，帮助教师轻松应对日常教学管理工作。

### 目标用户
- **主要用户**: 中小学班主任、任课教师
- **使用场景**:
  - 课间快速记录学生表现
  - 批量导入学生基础信息
  - 录入和分析考试成绩
  - 管理多个班级的学生信息
  - 查阅学生详细档案

### 产品特点
- ✅ **快速记录**: 随时随地记录学生相关事项
- ✅ **批量导入**: 支持Excel批量导入学生信息和成绩
- ✅ **多班级管理**: 支持管理多个班级，快速切换
- ✅ **完整档案**: 记录学生的全面信息
- ✅ **移动优先**: Android手机端使用

---

## 🏗️ 功能架构

### 核心功能模块

```
┌─────────────────────────────────────────────────────────┐
│                    Teacher Tools                        │
├─────────────────────────────────────────────────────────┤
│  📊 首页仪表板                                          │
│    - 快速操作入口                                        │
│    - 当前班级概览                                        │
│    - 最近记录                                            │
├─────────────────────────────────────────────────────────┤
│  👥 学生档案管理                                        │
│    - 学生列表（搜索、筛选）                              │
│    - 学生详情（完整档案）                                │
│    - 快速记录（随笔事件）                                │
├─────────────────────────────────────────────────────────┤
│  📚 成绩管理                                            │
│    - 成绩录入（批量导入）                                │
│    - 成绩查看和分析                                      │
│    - 成绩对比                                            │
├─────────────────────────────────────────────────────────┤
│  🏫 班级管理                                            │
│    - 班级列表                                            │
│    - 创建/编辑班级                                       │
│    - 切换当前班级                                        │
│    - 批量导入学生                                        │
├─────────────────────────────────────────────────────────┤
│  ⚙️ 设置                                                │
│    - 数据管理                                            │
│    - 导出数据                                            │
│    - 应用设置                                            │
└─────────────────────────────────────────────────────────┘
```

---

## 📊 数据模型设计

### 1. 班级 (Class)

**字段定义：**
```dart
class Class {
  int id;                    // 主键
  String name;               // 班级名称（如：三年级2班）
  String description;        // 班级描述（可选）
  int grade;                 // 年级（1-12）
  String schoolYear;         // 学年（如：2024-2025）
  bool isActive;             // 是否启用
  int studentCount;          // 学生人数（计算字段）
  DateTime createdAt;        // 创建时间
  DateTime updatedAt;        // 更新时间
}
```

**使用场景：**
- 教师管理多个班级（如：班主任管理本班，任课教师管理多个班）
- 快速切换当前班级
- 按班级查看学生和成绩

---

### 2. 学生 (Student)

**字段定义：**
```dart
class Student {
  int id;                    // 主键
  int classId;               // 所属班级ID（外键）

  // 基本信息
  String name;               // 姓名（必填）
  String studentNumber;      // 学号（必填，唯一）
  Gender gender;             // 性别（男/女）
  DateTime? birthDate;       // 出生日期

  // 身体特征
  double? height;            // 身高（cm）
  double? visionLeft;        // 左眼视力
  double? visionRight;       // 右眼视力

  // 联系方式
  String? phone;             // 学生电话（可选）
  String parentName;         // 父母/监护人姓名（必填）
  String parentPhone;        // 父母电话（必填）
  String? parentProfession;  // 父母职业
  String? parentName2;       // 第二监护人姓名
  String? parentPhone2;      // 第二监护人电话
  String? parentProfession2; // 第二监护人职业

  // 职务信息
  String? classPosition;     // 班干部职位（如：班长、学习委员）
  String? committeePosition; // 家委会职位（如：家委会主席）

  // 其他信息
  String? personality;       // 性格特点（文本描述）
  String? remarks;           // 备注信息
  String? address;           // 家庭住址

  // 系统字段
  DateTime createdAt;        // 创建时间
  DateTime updatedAt;        // 更新时间
  bool isActive;             // 是否在籍（转学等标记）
}

enum Gender {
  male,      // 男
  female,    // 女
  unknown    // 未知
}
```

**字段说明：**
- **必填字段**: 姓名、学号、父母姓名、父母电话
- **学号唯一性**: 在班级内唯一
- **可选字段**: 视力、身高、第二监护人等

---

### 3. 随笔事件 (Note)

**字段定义：**
```dart
class Note {
  int id;                    // 主键
  int studentId;             // 学生ID（外键）
  int classId;               // 班级ID（外键，冗余用于快速查询）

  String title;              // 标题（可选，自动生成或手动输入）
  String content;            // 内容（必填）
  NoteType type;             // 类型（表现、作业、考勤、其他）

  // 标签系统
  List<String> tags;         // 标签（JSON存储，如：["积极", "表扬"]）

  // 时间信息
  DateTime occurredAt;       // 事件发生时间（默认当前时间）
  DateTime createdAt;        // 记录创建时间

  // 关联信息
  int? authorId;             // 记录人（预留，多用户版本）
}

enum NoteType {
  performance,  // 表现（表扬/批评）
  homework,     // 作业
  attendance,   // 考勤
  activity,     // 活动
  other         // 其他
}
```

**使用场景：**
- 课后快速记录学生表现
- 记录作业完成情况
- 记录考勤信息
- 附加标签便于后续筛选和统计

---

### 4. 考试 (Exam)

**字段定义：**
```dart
class Exam {
  int id;                    // 主键
  int classId;               // 班级ID（外键）

  String name;               // 考试名称（如：期中考试、单元测试）
  Subject subject;           // 科目（必填：数学、语文、英语、科学、道德）
  ExamType type;             // 考试类型
  DateTime examDate;         // 考试日期

  // 分数统计（计算字段）
  double? averageScore;      // 平均分
  double? maxScore;          // 最高分
  double? minScore;          // 最低分
  int? passCount;            // 及格人数
  int studentCount;          // 参考人数

  DateTime createdAt;
  DateTime updatedAt;
}

enum Subject {
  math,           // 数学
  chinese,        // 语文
  english,        // 英语
  science,        // 科学
  morality,       // 道德
}

enum ExamType {
  midTerm,        // 期中考试
  finalTerm,      // 期末考试
  unit,           // 单元测试
  monthly,        // 月考
  quiz,           // 随堂测验
  other           // 其他
}
```

**科目说明：**
- 数学、语文、英语、科学、道德为5个固定科目
- 每次考试只对应一个科目
- 例如："期中考试-数学" 和 "期中考试-语文" 是两条独立的考试记录
- 便于分别统计各科成绩和趋势

**科目管理原则：**
1. **固定科目**：不支持自定义科目，确保数据一致性
2. **独立考试**：每个科目的考试独立管理，便于统计
3. **批量导入**：每个科目需要单独的Excel文件导入
4. **成绩分析**：支持按科目筛选、统计和对比
5. **数据完整性**：数据库层面通过CHECK约束确保科目有效性

---

### 5. 成绩 (Score)

**字段定义：**
```dart
class Score {
  int id;                    // 主键
  int examId;                // 考试ID（外键）
  int studentId;             // 学生ID（外键）
  int classId;               // 班级ID（外键，冗余）

  double score;              // 分数
  double? fullScore;         // 满分（默认100）
  int? ranking;              // 排名（计算字段）
  String? remarks;           // 备注

  DateTime createdAt;
  DateTime updatedAt;

  // 关联查询
  Student get student;       // 学生信息
  Exam get exam;             // 考试信息
}
```

**索引设计：**
- 复合索引：`(examId, studentId)` 唯一
- 复合索引：`(studentId, examDate)` 用于查询学生历史成绩
- 复合索引：`(classId, examId)` 用于班级成绩统计

---

## 📥 Excel 导入格式规范

### 学生信息导入

**Excel文件命名：** `学生信息_班级名_日期.xlsx`

**表头格式：**

| 列号 | 字段名 | 必填 | 说明 | 示例 |
|-----|--------|------|------|------|
| A   | 姓名   | ✅   | 学生姓名 | 张三 |
| B   | 学号   | ✅   | 班内唯一 | 20240101 |
| C   | 性别   | ✅   | 男/女 | 男 |
| D   | 出生日期 | ⭕ | 格式：YYYY-MM-DD | 2012-05-15 |
| E   | 身高   | ⭕   | 单位：cm | 145 |
| F   | 左眼视力 | ⭕ | 视力数值 | 5.0 |
| G   | 右眼视力 | ⭕ | 视力数值 | 4.8 |
| H   | 学生电话 | ⭕ | 联系电话 | 138****1234 |
| I   | 父母姓名 | ✅   | 父母或监护人 | 张父 |
| J   | 父母电话 | ✅   | 父母联系电话 | 139****5678 |
| K   | 父母职业 | ⭕ | 职业描述 | 工程师 |
| L   | 第二监护人 | ⭕ | 姓名 | 李母 |
| M   | 第二监护人电话 | ⭕ | 电话 | 136****9012 |
| N   | 第二监护人职业 | ⭕ | 职业 | 教师 |
| O   | 家庭住址 | ⭕ | 详细地址 | XX市XX区XX路 |
| P   | 班干部职位 | ⭕ | 如：班长、学习委员 | 班长 |
| Q   | 家委会职位 | ⭕ | 如：家委会成员 | 主席 |
| R   | 性格特点 | ⭕ | 文本描述 | 活泼开朗 |
| S   | 备注   | ⭕   | 其他说明 | 过敏体质 |

**导入规则：**
- 必填字段不能为空
- 学号不能重复
- 性别只能是"男"或"女"
- 日期格式必须正确
- 数字字段必须是有效数字
- 导入前显示预览，确认后导入
- 导入失败显示具体错误信息（行号+原因）

**下载模板功能：**
- 应用内提供标准模板下载
- 模板包含表头和示例数据
- 用户可基于模板编辑后导入

---

### 成绩导入

**Excel文件命名：** `成绩_考试名称_科目_日期.xlsx`
- 示例：`成绩_期中考试_数学_20241115.xlsx`

**表头格式：**

| 列号 | 字段名 | 必填 | 说明 | 示例 |
|-----|--------|------|------|------|
| A   | 学号   | ✅   | 对应学生学号 | 20240101 |
| B   | 姓名   | ✅   | 学生姓名（校验用） | 张三 |
| C   | 分数   | ✅   | 考试分数 | 95.5 |
| D   | 备注   | ⭕   | 备注信息 | 进步明显 |

**科目说明：**
- 支持5个科目：数学、语文、英语、科学、道德
- 每个科目需要单独导入（一个Excel文件只包含一个科目的成绩）
- 文件名中必须包含科目信息，用于校验

**导入流程：**
1. **选择班级** - 先确定要导入的班级
2. **创建考试** - 输入考试信息：
   - 考试名称（如：期中考试）
   - **科目选择**（数学/语文/英语/科学/道德）- 必选
   - 考试类型（期中/期末/单元/月考/测验/其他）
   - 考试日期
   - 满分值（默认100）
3. **上传Excel** - 选择对应科目的成绩文件
4. **预览数据** - 显示导入预览，高亮异常数据
   - 学号不存在 → 红色
   - 分数超出范围 → 黄色
   - 学号重复 → 橙色
5. **确认导入** - 用户确认后写入数据库
6. **导入结果** - 显示成功/失败统计

**验证规则：**
- 学号必须存在于当前班级
- 姓名与学号匹配（可选验证）
- 分数范围：0-满分
- 同一学号只能出现一次
- Excel科目与创建考试时选择的科目必须一致（可选验证）

---

## 🎨 界面设计

### 1. 启动流程

```
┌──────────────────────┐
│   启动应用           │
└──────────┬───────────┘
           │
           ▼
┌──────────────────────┐      ┌──────────────────────┐
│  是否有班级？        │ 是   │  进入首页（当前班级）│
└──────────┬───────────┘ └──────────────────────┘
           │ 否
           ▼
┌──────────────────────┐
│  引导页：创建班级    │
│  - 输入班级名称      │
│  - 选择年级          │
│  - 选择学年          │
└──────────┬───────────┘
           │
           ▼
┌──────────────────────┐
│  选择：              │
│  1. 批量导入学生     │
│  2. 手动添加学生     │
│  3. 稍后添加         │
└──────────────────────┘
```

---

### 2. 首页（仪表板）

**布局：**

```
┌────────────────────────────────────┐
│  三年级2班        🔔 切换班级      │  ← AppBar
├────────────────────────────────────┤
│                                    │
│  📊 班级概况                       │
│  ┌────────┬────────┬────────┐    │
│  │ 学生数 │ 平均分 │  最近  │    │
│  │  45人  │  85.5  │ 考试   │    │
│  └────────┴────────┴────────┘    │
│                                    │
│  ⚡ 快速操作                       │
│  ┌──────────┬──────────┐          │
│  │ 📝 记录  │ 📊 成绩  │          │
│  │ 随笔事件 │  录入    │          │
│  ├──────────┼──────────┤          │
│  │ 👥 查看  │ ➕ 添加  │          │
│  │ 学生列表 │  学生    │          │
│  └──────────┴──────────┘          │
│                                    │
│  🕐 最近记录                       │
│  • 张三 - 课堂表现积极 (2小时前)  │
│  • 李四 - 作业未完成 (昨天)       │
│  • 王五 - 数学测验满分 (2天前)    │
│                                    │
└────────────────────────────────────┘
```

**交互：**
- 点击班级名称 → 切换班级页面
- 点击快速操作卡片 → 跳转对应功能
- 点击最近记录 → 查看详情
- 下拉刷新 → 更新数据

---

### 3. 学生列表页

**布局：**

```
┌────────────────────────────────────┐
│  👥 学生列表        🔍 搜索       │
├────────────────────────────────────┤
│  筛选：全部 ▼  |  男  |  女       │  ← 筛选器
├────────────────────────────────────┤
│                                    │
│  ┌──────────────────────────────┐ │
│  │ 👤 张三         学号:001    │ │
│  │ 📱 父母:张父 139****5678    │ │
│  │ 🏷️ 班长 | 活泼开朗          │ │
│  │ 💬 3条记录                  │ │
│  └──────────────────────────────┘ │
│                                    │
│  ┌──────────────────────────────┐ │
│  │ 👤 李四         学号:002    │ │
│  │ 📱 父母:李父 138****1234    │ │
│  │ 💬 1条记录                  │ │
│  └──────────────────────────────┘ │
│                                    │
│  ...                               │
│                                    │
├────────────────────────────────────┤
│        ➕ 悬浮按钮（添加学生）      │
└────────────────────────────────────┘
```

**功能：**
- **搜索**: 实时搜索（姓名、学号）
- **筛选**: 性别、班干部、家委会成员
- **排序**: 姓名、学号、最近记录
- **点击卡片**: 进入学生详情页
- **长按卡片**: 显示快捷菜单（呼叫、记录笔记）

---

### 4. 学生详情页

**布局：**

```
┌────────────────────────────────────┐
│  ← 返回              ⚙️ 更多操作   │
├────────────────────────────────────┤
│  👤 张三                           │
│  学号：20240101  |  男  |  12岁    │
├────────────────────────────────────┤
│  📋 基本信息                       │
│  • 出生日期：2012-05-15            │
│  • 身高：145cm                     │
│  • 视力：左 5.0 / 右 4.8           │
│                                    │
│  👪 家长信息                       │
│  • 父母：张父 139****5678         │
│    职业：工程师                    │
│  • 母亲：李母 136****9012         │
│    职业：教师                      │
│                                    │
│  🏫 学校职务                       │
│  • 班干部：班长                    │
│  • 家委会：主席                    │
│                                    │
│  🎭 性格特点                       │
│  活泼开朗，善于沟通，热爱运动      │
│                                    │
│  📝 随笔记录 (3)                   │
│  ─────────────────────────────────│
│  ✅ 课堂表现积极           今天    │
│     认真听讲，积极举手发言         │
│  ─────────────────────────────────│
│  📚 数学测验满分           2天前  │
│     期中考试数学获得满分           │
│  ─────────────────────────────────│
│  ⚠️ 作业迟交               1周前  │
│     数学作业迟交一天              │
│                                    │
├────────────────────────────────────┤
│  ➕ 快速记录   |   📊 查看成绩     │
└────────────────────────────────────┘
```

**操作：**
- **电话图标**: 直接拨打家长电话
- **编辑**: 修改学生信息
- **删除**: 删除学生（需确认）
- **快速记录**: 打开记事本
- **查看成绩**: 成绩历史和统计

---

### 5. 快速记录（随笔事件）

**入口：**
- 首页快速操作
- 学生详情页
- 学生列表长按

**布局：**

```
┌────────────────────────────────────┐
│  ← 返回              ✅ 保存       │
├────────────────────────────────────┤
│  选择学生                           │
│  ┌──────────────────────────────┐ │
│  │ 👤 张三         20240101     │ │  ← 学生选择器
│  └──────────────────────────────┘ │
│                                    │
│  记录内容                           │
│  ┌──────────────────────────────┐ │
│  │                              │ │
│  │  [文本输入框]                │ │
│  │                              │ │
│  └──────────────────────────────┘ │
│                                    │
│  类型：[表现 ▼]  |  时间：今天    │
│                                    │
│  标签（可选）                       │
│  #积极 #表扬 #课堂                 │
│                                    │
└────────────────────────────────────┘
```

**标签推荐：**
- 表现类：积极、进步、优秀、待改进
- 作业类：完成、未完成、优秀、工整
- 考勤类：迟到、早退、请假、缺勤
- 其他自定义标签

**保存后：**
- 自动保存到学生档案
- 更新首页"最近记录"
- 可后续编辑和删除

---

### 6. 成绩录入页

**布局：**

```
┌────────────────────────────────────┐
│  ← 返回              📥 导入Excel  │
├────────────────────────────────────┤
│  创建考试                           │
│  • 考试名称：[期中考试]            │
│  • 科目：*[数学 ▼]*                │  ← 必选：数学/语文/英语/科学/道德
│  • 类型：[期中考试 ▼]              │
│  • 日期：[2024-11-15]              │
│  • 满分：[100]                     │
│                                    │
│  ┌──────────────────────────────┐ │
│  │   📥 批量导入成绩            │ │
│  │   上传Excel文件              │ │
│  │   支持格式：.xlsx            │ │
│  └──────────────────────────────┘ │
│                                    │
│  [下载导入模板]                    │
│                                    │
│  科目模板：                         │
│  • [数学模板] [语文模板]           │
│  • [英语模板] [科学模板]           │
│  • [道德模板]                      │
│                                    │
└────────────────────────────────────┘
```

**科目选择说明：**
- 5个固定科目：数学、语文、英语、科学、道德
- 每次创建考试时必须选择科目
- 不同科目需要分别导入（一次只导入一个科目）
- 模板下载会根据选择的科目提供对应示例

**导入流程：**
1. 填写考试信息（包括选择科目）
2. 下载对应科目的导入模板（可选）
3. 点击"导入Excel"
4. 选择文件
5. 预览数据（系统会校验科目是否匹配）
6. 确认导入

---

### 7. 成绩查看页

**布局：**

```
┌────────────────────────────────────┐
│  ← 返回    期中考试-数学   📊     │
├────────────────────────────────────┤
│  科目筛选：[全部 ▼]                │  ← 筛选：全部/数学/语文/英语/科学/道德
│  考试列表：                         │
│  • 期中考试-数学 (2024-11-15)      │
│  • 期中考试-语文 (2024-11-14)      │
│  • 期中考试-英语 (2024-11-13)      │
├────────────────────────────────────┤
│  📈 统计概览                       │
│  ┌──────────────────────────────┐ │
│  │ 平均分  最高分  最低分  及格率│
│  │ 85.5    100     52      92%  │
│  └──────────────────────────────┘ │
│                                    │
│  📊 成绩列表                       │
│  ┌──────────────────────────────┐ │
│  │ 1. 张三    100分 🏆         │ │
│  └──────────────────────────────┘ │
│  ┌──────────────────────────────┐ │
│  │ 2. 李四    95分             │ │
│  └──────────────────────────────┘ │
│  ┌──────────────────────────────┐ │
│  │ 3. 王五    92分             │ │
│  └──────────────────────────────┘ │
│  ...                              │
│                                    │
├────────────────────────────────────┤
│    [按分数排序]  [按学号排序]      │
└────────────────────────────────────┘
```

**科目筛选功能：**
- **全部科目**：显示所有考试（按日期倒序）
- **按科目筛选**：只显示选定科目的考试
- 筛选后统计数据也会相应更新

**成绩对比功能：**
- 支持查看同一学生在不同科目的成绩
- 支持查看同一科目的历次成绩趋势

---

### 8. 班级管理页

**布局：**

```
┌────────────────────────────────────┐
│  ← 返回              ➕ 新建班级   │
├────────────────────────────────────┤
│  我的班级                           │
│                                    │
│  ┌──────────────────────────────┐ │
│  │ ✅ 三年级2班 (当前)    45人  │ │  ← 当前班级
│  │    2024-2025学年            │ │
│  └──────────────────────────────┘ │
│                                    │
│  ┌──────────────────────────────┐ │
│  │    三年级1班           42人  │ │
│  │    2024-2025学年            │ │
│  └──────────────────────────────┘ │
│                                    │
│  ┌──────────────────────────────┐ │
│  │    四年级1班           38人  │ │
│  │    2024-2025学年            │ │
│  └──────────────────────────────┘ │
│                                    │
│  ...                               │
│                                    │
└────────────────────────────────────┘
```

**操作：**
- 点击非当前班级 → 切换班级（需确认）
- 新建班级 → 输入班级信息
- 编辑班级 → 修改班级信息
- 删除班级 → 仅当没有学生时可删除

---

### 9. 班级详情/导入页

**布局：**

```
┌────────────────────────────────────┐
│  ← 返回              ⚙️           │
├────────────────────────────────────┤
│  三年级2班                         │
│  年级：三年级   学年：2024-2025    │
│  学生人数：45人                    │
├────────────────────────────────────┤
│  📥 批量导入学生                   │
│  ┌──────────────────────────────┐ │
│  │   上传Excel文件              │ │
│  │   支持批量导入学生信息       │ │
│  └──────────────────────────────┘ │
│  [下载导入模板]                    │
│                                    │
│  ➕ 手动添加学生                   │
│  ┌──────────────────────────────┐ │
│  │   逐个添加学生信息           │ │
│  └──────────────────────────────┘ │
│                                    │
│  📤 导出数据                       │
│  ┌──────────────────────────────┐ │
│  │   导出学生信息为Excel        │ │
│  └──────────────────────────────┘ │
│                                    │
│  🗑️ 班级管理                      │
│  • 编辑班级信息                   │
│  • 删除班级                       │
│                                    │
└────────────────────────────────────┘
```

---

## 🔄 业务流程

### 1. 初次使用流程

```
启动应用
    │
    ▼
检查是否有班级数据
    │
    ├─ 有数据 ──> 直接进入首页
    │
    └─ 无数据 ──> 引导创建班级
                    │
                    ├─ 输入班级名称
                    ├─ 选择年级（1-12）
                    ├─ 选择学年
                    │
                    ▼
              选择添加学生方式
                    │
                    ├─ 方式1：批量导入
                    │         ├─ 下载模板
                    │         ├─ 编辑Excel
                    │         └─ 上传导入
                    │
                    ├─ 方式2：手动添加
                    │         └─ 逐个录入
                    │
                    └─ 方式3：稍后添加
                              └─ 进入空班级首页
```

---

### 2. 日常记录流程

```
首页
    │
    ▼
选择快速操作
    │
    ├─ 记录随笔事件
    │       │
    │       ├─ 选择学生（搜索/列表）
    │       ├─ 输入内容
    │       ├─ 选择类型（表现/作业/考勤）
    │       ├─ 添加标签（可选）
    │       └─ 保存
    │
    ├─ 查看学生列表
    │       │
    │       ├─ 搜索学生
    │       ├─ 点击学生卡片
    │       └─ 进入详情
    │
    └─ 录入成绩
            │
            ├─ 创建考试
            ├─ 上传Excel
            ├─ 预览确认
            └─ 导入完成
```

---

### 3. 切换班级流程

```
首页（点击班级名）
    │
    ▼
班级列表页
    │
    ▼
选择目标班级
    │
    ├─ 显示确认对话框
    │   "确定切换到 [目标班级] 吗？"
    │
    ├─ 确认 ──> 更新当前班级
    │          └─ 返回首页（显示新班级数据）
    │
    └─ 取消 ──> 返回班级列表
```

---

### 4. Excel导入流程

**学生信息导入：**
```
班级详情页
    │
    ▼
点击"批量导入学生"
    │
    ▼
下载/查看模板
    │
    ▼
准备Excel文件
    │
    ▼
上传文件
    │
    ▼
解析Excel数据
    │
    ├─ 解析成功 ──> 显示预览
    │                   │
    │                   ├─ 显示数据条数
    │                   ├─ 高亮异常数据
    │                   └─ 显示错误提示
    │                       │
    │                       ▼
    │                  用户确认导入
    │                       │
    │                       ▼
    │                  写入数据库
    │                       │
    │                       ▼
    │                  显示导入结果
    │                  • 成功：XX条
    │                  • 失败：XX条
    │
    └─ 解析失败 ──> 显示错误信息
                    └─ 返回重新上传
```

**成绩导入：**
```
成绩管理页
    │
    ▼
创建新考试
    │
    ▼
填写考试信息
（名称、科目、类型、日期、满分）
    │
    ▼
上传成绩Excel
    │
    ▼
解析并验证
    │
    ├─ 学号校验
    ├─ 姓名校验（可选）
    ├─ 分数范围校验
    └─ 重复校验
    │
    ▼
显示预览
    │
    ├─ 绿色：正常数据
    ├─ 红色：学号不存在
    ├─ 黄色：分数异常
    └─ 橙色：学号重复
    │
    ▼
用户确认
    │
    ▼
导入数据
    │
    ├─ 创建成绩记录
    ├─ 更新考试统计
    └─ 更新学生成绩历史
    │
    ▼
显示结果
    │
    └─ 跳转到成绩查看页
```

---

## 🎯 核心功能优先级

### P0 - 核心功能（MVP）
1. ✅ **班级管理**
   - 创建/编辑/删除班级
   - 切换当前班级
   - 班级列表展示

2. ✅ **学生信息管理**
   - 手动添加学生
   - 编辑/删除学生
   - 学生列表展示
   - 学生详情查看

3. ✅ **快速记录**
   - 记录随笔事件
   - 查看历史记录
   - 记录列表展示

4. ✅ **Excel导入**
   - 学生信息批量导入
   - Excel解析和验证
   - 导入预览和确认

### P1 - 重要功能
5. ✅ **成绩管理**
   - 创建考试
   - 成绩Excel导入
   - 成绩列表展示
   - 成绩统计（平均分、最高分、最低分）

6. ✅ **搜索和筛选**
   - 学生搜索
   - 按性别筛选
   - 按职务筛选

7. ✅ **数据导出**
   - 导出学生信息为Excel
   - 导出成绩为Excel

### P2 - 增强功能
8. ✅ **数据统计**
   - 班级概况统计
   - 学生成绩趋势
   - 标签统计分析

9. ✅ **用户体验优化**
   - 首页仪表板
   - 快速操作入口
   - 最近记录展示

10. ✅ **高级功能**
    - 数据备份和恢复
    - 主题切换
    - 数据管理（清空、导出全部）

---

## 💾 数据存储设计

### 本地数据库结构

```sql
-- 班级表
CREATE TABLE classes (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    description TEXT,
    grade INTEGER,
    school_year TEXT,
    is_active INTEGER DEFAULT 1,
    created_at TEXT NOT NULL,
    updated_at TEXT NOT NULL
);

-- 学生表
CREATE TABLE students (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    class_id INTEGER NOT NULL,
    name TEXT NOT NULL,
    student_number TEXT NOT NULL,
    gender TEXT NOT NULL,
    birth_date TEXT,
    height REAL,
    vision_left REAL,
    vision_right REAL,
    phone TEXT,
    parent_name TEXT NOT NULL,
    parent_phone TEXT NOT NULL,
    parent_profession TEXT,
    parent_name2 TEXT,
    parent_phone2 TEXT,
    parent_profession2 TEXT,
    class_position TEXT,
    committee_position TEXT,
    personality TEXT,
    remarks TEXT,
    address TEXT,
    is_active INTEGER DEFAULT 1,
    created_at TEXT NOT NULL,
    updated_at TEXT NOT NULL,
    FOREIGN KEY (class_id) REFERENCES classes(id) ON DELETE CASCADE,
    UNIQUE(class_id, student_number)
);

CREATE INDEX idx_students_class ON students(class_id);
CREATE INDEX idx_students_number ON students(student_number);

-- 随笔事件表
CREATE TABLE notes (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    student_id INTEGER NOT NULL,
    class_id INTEGER NOT NULL,
    title TEXT,
    content TEXT NOT NULL,
    type TEXT NOT NULL,
    tags TEXT,
    occurred_at TEXT NOT NULL,
    created_at TEXT NOT NULL,
    FOREIGN KEY (student_id) REFERENCES students(id) ON DELETE CASCADE,
    FOREIGN KEY (class_id) REFERENCES classes(id) ON DELETE CASCADE
);

CREATE INDEX idx_notes_student ON notes(student_id);
CREATE INDEX idx_notes_class ON notes(class_id);
CREATE INDEX idx_notes_date ON notes(occurred_at DESC);

-- 考试表
CREATE TABLE exams (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    class_id INTEGER NOT NULL,
    name TEXT NOT NULL,
    subject TEXT NOT NULL,  -- 科目：必填，只能是数学/语文/英语/科学/道德
    type TEXT NOT NULL,
    exam_date TEXT NOT NULL,
    average_score REAL,
    max_score REAL,
    min_score REAL,
    pass_count INTEGER,
    student_count INTEGER,
    created_at TEXT NOT NULL,
    updated_at TEXT NOT NULL,
    FOREIGN KEY (class_id) REFERENCES classes(id) ON DELETE CASCADE,
    CHECK(subject IN ('数学', '语文', '英语', '科学', '道德'))
);

CREATE INDEX idx_exams_class ON exams(class_id);
CREATE INDEX idx_exams_date ON exams(exam_date DESC);
CREATE INDEX idx_exams_subject ON exams(subject);  -- 按科目查询

-- 成绩表
CREATE TABLE scores (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    exam_id INTEGER NOT NULL,
    student_id INTEGER NOT NULL,
    class_id INTEGER NOT NULL,
    score REAL NOT NULL,
    full_score REAL DEFAULT 100,
    ranking INTEGER,
    remarks TEXT,
    created_at TEXT NOT NULL,
    updated_at TEXT NOT NULL,
    FOREIGN KEY (exam_id) REFERENCES exams(id) ON DELETE CASCADE,
    FOREIGN KEY (student_id) REFERENCES students(id) ON DELETE CASCADE,
    FOREIGN KEY (class_id) REFERENCES classes(id) ON DELETE CASCADE,
    UNIQUE(exam_id, student_id)
);

CREATE INDEX idx_scores_exam ON scores(exam_id);
CREATE INDEX idx_scores_student ON scores(student_id);
CREATE INDEX idx_scores_class ON scores(class_id);
```

---

## 🔐 数据安全

### 隐私保护
- 所有数据仅存储在本地设备
- 不涉及网络传输和云端存储
- 用户可随时删除或导出数据

### 数据备份
- 支持导出全部数据为Excel
- 支持导入备份数据
- 建议用户定期导出备份

---

## 📱 技术约束

### 性能要求
- 应用启动时间 < 2秒
- 页面切换流畅（60fps）
- Excel导入（100条）< 3秒
- 搜索响应 < 500ms

### 兼容性
- Android 5.0 (API 21) 及以上
- 适配不同屏幕尺寸
- 支持横竖屏切换

---

## 📝 待明确事项

### 需要与用户确认
1. **应用名称** - 正式名称？
2. **主题色** - 偏好的主色调？
3. **应用图标** - 是否有设计要求？
4. **数据字段** - 学生信息字段是否需要调整？
5. **导入格式** - Excel格式是否满足需求？
6. **额外功能** - 是否有其他必需功能？

### 可选功能（未定）
- [ ] 消息提醒功能
- [ ] 数据图表展示
- [ ] 学生照片管理
- [ ] 语音输入记录
- [ ] 打印功能

---

**文档结束**

**下一步**: 基于功能设计，开始实现核心功能开发。
